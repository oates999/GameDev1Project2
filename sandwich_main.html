<html>
<head>
	<meta charset="UTF-8" />
	<title>Sandwich Game Placeholder Title</title>
	<script type="text/javascript" src="js/phaser.min.js"></script>
	<style text="text/css">
		body {
			margin: 0;
		}
	</style>
</head>

<body>
<script type="text/javascript">

//============GLOBAL Variables===================//
var game = new Phaser.Game(750, 1334, Phaser.AUTO, '',
	{preload: preload, create: create, update: update});
//Mouse Controls
var x_on_start;					//data storage for swipe detect
var x_on_stop;
var y_on_start;
var y_on_stop;
//Functional Objects
var wheel;							//wheel object
	var leftTweenAlpha;			//		wheel rotation left (major)
	var leftTweenBeta;			//		wheel rotation left (minor)
	var rightTweenAlpha;			//		wheel rotation right (major)
	var rightTweenBeta;			//		wheel rotation right (minor)
	var tween_duration = 200;	//		duration of tween (ms)
var plate_1;						//green quadrant plate object
	var plate1_tweenAlpha;		//		plate hop up
	var plate1_tweenBeta;		//		plate hop down
var plate_2;						//purple quadrant plate object
	var plate2_tweenAlpha;		//		plate hop up
	var plate2_tweenBeta;		//		plate hop down
var plate_3;						//blue quadrant plate object
	var plate3_tweenAlpha;		//		plate hop up
	var plate3_tweenBeta;		//		plate hop down
//Ingredients
var sandwich_scale = 0.6;
var ingredient_amount = 10;
var possibleItems = [];
var possibleLetters = [];
var nextFall = [];
var nextSpawn;
var fallQueue = [];
var fallingItems;
var falling_item_array = [];
var falling_item_numbers = [];
var weighted_item_spawns = [];
//Background Objects
var kitchen_0;
var kitchen_1;
var conveyor_belt;
var chefbot_body;
var chefbot_head;
var chefbot_arm;
//Recipe Storage
var active_recipes = [];
var active_recipe_timers = [];
var active_recipe_images = [];
var active_sandwiches = [[], [], []];
var active_sandwich_images = [];
var active_sandwich_heights = [0, 0, 0];
var active_plate_height;
var active_sandwich_index = 0;
var wheel_antimodifier;
var sandwich_max_size = 3;
var sandwiches_completed = 0;
var active_letter_locations_x = [-25, 25, -80, 80, -135, 135, 0, -55, 55, -110, 110];
var active_letter_locations_y = [55, 55, 58, 58, 70, 70, 110, 113, 113, 120, 120];
//User Interface Elements
var time_remaining;
var low_time_remaining;
var score_text;
var score_amount;
var timer_score_backing;
var time_flash;
var low_time_flash;
//Rendering Groups
var background_layer;					//background, recipe images
var foreground_layer;					//wheel, sandwiches, particles
var superforeground_layer;				//falling ingredients
var userinterface_layer;				//pause menu, menu buttons, score
//Temporary Variables

function preload () {
	//Functional Elements
	game.load.image("wheel_sprite", "assets/images/placeholder/placeholder_wheel.png");
	game.load.image("plate_sprite", "assets/images/big_plate.png");
	game.load.image("currency_sprite", "assets/images/currency.png");
	/*game.load.image("currency_sprite", "assets/images/currency_digital.png");*/
	game.load.image("chefbot_body_sprite", "assets/images/chefbot_body.png");
	game.load.image("chefbot_head_sprite", "assets/images/chefbot_head.png");
	game.load.image("chefbot_arm_sprite", "assets/images/chefbot_arm.png");
	//Ingredient Elements
	game.load.image("bread_sprite", "assets/images/bread.png");
	game.load.image("cheese_sprite", "assets/images/cheese.png");
	possibleItems.push("cheese_sprite");
	game.load.image("onion_sprite", "assets/images/onion.png");
	possibleItems.push("onion_sprite");
	game.load.image("tomato_sprite", "assets/images/tomato.png");
	possibleItems.push("tomato_sprite");
	game.load.image("lettuce_sprite", "assets/images/lettuce.png");
	possibleItems.push("lettuce_sprite");
	game.load.image("ham_sprite", "assets/images/ham.png");
	possibleItems.push("ham_sprite");
	game.load.image("turkey_sprite", "assets/images/turkey.png");
	possibleItems.push("turkey_sprite");
	game.load.image("peanutbutter_sprite", "assets/images/peanutbutter.png");
	possibleItems.push("peanutbutter_sprite");
	game.load.image("jelly_sprite", "assets/images/jelly.png");
	possibleItems.push("jelly_sprite");
	game.load.image("bacon_sprite", "assets/images/bacon.png");
	possibleItems.push("bacon_sprite");
	game.load.image("pickle_sprite", "assets/images/pickle.png");
	possibleItems.push("pickle_sprite");
	game.load.image("mayo_sprite", "assets/images/mayo.png");
	possibleItems.push("mayo_sprite");

	game.load.image("cheese_letter", "assets/images/letters/letter_Ch.png");
	possibleLetters.push("cheese_letter");
	game.load.image("onion_letter", "assets/images/letters/letter_On.png");
	possibleLetters.push("onion_letter");
	game.load.image("tomato_letter", "assets/images/letters/letter_To.png");
	possibleLetters.push("tomato_letter");
	game.load.image("lettuce_letter", "assets/images/letters/letter_Le.png");
	possibleLetters.push("lettuce_letter");
	game.load.image("ham_letter", "assets/images/letters/letter_Ha.png");
	possibleLetters.push("ham_letter");
	game.load.image("turkey_letter", "assets/images/letters/letter_Tu.png");
	possibleLetters.push("turkey_letter");
	game.load.image("peanutbutter_letter", "assets/images/letters/letter_Pe.png");
	possibleLetters.push("peanutbutter_letter");
	game.load.image("jelly_letter", "assets/images/letters/letter_Je.png");
	possibleLetters.push("jelly_letter");
	game.load.image("bacon_letter", "assets/images/letters/letter_Ba.png");
	possibleLetters.push("bacon_letter");
	game.load.image("pickle_letter", "assets/images/letters/letter_Pi.png");
	possibleLetters.push("pickle_letter");
	game.load.image("mayo_letter", "assets/images/letters/letter_Ma.png");
	possibleLetters.push("mayo_letter");
	//Background Elements
	game.load.image("kitchen_back", "assets/images/kitchen_back.png");
	game.load.image("kitchen_front", "assets/images/kitchen_front.png");
	game.load.image("conveyor_belt", "assets/images/conveyorbelt.png");
	game.load.image("diner_floor", "assets/images/diner_floor.png");
	game.load.image("floor_gradient", "assets/images/diner_floor_gradient.png");
	game.load.image("background_gradient", "assets/images/kitchen_backing_gradient.png");
	//User Interface Elements
	game.load.image("recipe_backing", "assets/images/recipe_backing.png");
	game.load.image("blank_sprite", "assets/images/null.png");
	game.load.image("timer_backing", "assets/images/timer_score_backing.png");
}

function create() {
	game.physics.startSystem(Phaser.Physics.ARCADE);
	game.input.mouse.capture = true;
	//Layer Ordering
	background_layer = game.add.group();
	foreground_layer = game.add.group();
	superforeground_layer = game.add.group();
	userinterface_layer = game.add.group();

	//Creation and postioning of background sprites
	var kitchen_backing_gradient = game.add.sprite(0, 0, "background_gradient");
	kitchen_0 = game.add.sprite(game.width/2, 0, "kitchen_back");
	kitchen_0.alpha = 0.8;

	chefbot_body = game.add.sprite(game.width/2 - 40, 90, "chefbot_body_sprite");
	chefbot_body.anchor.set(0.5, 0);
	chefbot_head = game.add.sprite(25, -10, "chefbot_head_sprite");
	chefbot_head.anchor.set(0.5, 0.5);
	chefbot_arm = game.add.sprite(2*game.width/3 - 20, 320, "chefbot_arm_sprite");
	chefbot_arm.anchor.set(0, 1);
	chefbot_body.addChild(chefbot_head);

	var chefbot_breathe1 = game.add.tween(chefbot_body).to({y: "-10"}, 1600, Phaser.Easing.Quadratic.InOut);
	var chefbot_breathe2 = game.add.tween(chefbot_body).to({y: "+10"}, 1400, Phaser.Easing.Quadratic.InOut);
	chefbot_breathe1.chain(chefbot_breathe2);
	chefbot_breathe2.chain(chefbot_breathe1);
	chefbot_breathe1.start();

	var chefbot_bobble1 = game.add.tween(chefbot_head).to({angle: "+30", y: "+6"}, 1200, Phaser.Easing.Bounce.InOut);
	var chefbot_bobble2 = game.add.tween(chefbot_head).to({angle: "-50", y: "-2"}, 1600, Phaser.Easing.Bounce.InOut);
	var chefbot_bobble3 = game.add.tween(chefbot_head).to({angle: "+20", y: "-4"}, 1200, Phaser.Easing.Bounce.InOut);
	chefbot_bobble1.chain(chefbot_bobble2);
	chefbot_bobble2.chain(chefbot_bobble3);
	chefbot_bobble3.chain(chefbot_bobble1);
	chefbot_bobble1.start();

	kitchen_1 = game.add.sprite(game.width/2, 0, "kitchen_front");
	kitchen_0.anchor.set(0.5, 0);
	kitchen_1.anchor.set(0.5, 0);
	conveyor_belt = game.add.sprite(game.width/2, 195, "conveyor_belt");
	conveyor_belt.anchor.set(0.5, 0);
	floor = game.add.sprite(game.width/2, game.height, "diner_floor");
	var gradient = game.add.sprite(game.width/2, game.height, "floor_gradient");
	floor.anchor.set(0.5, 1);
	gradient.anchor.set(0.5, 1);

	background_layer.add(kitchen_backing_gradient);
	background_layer.add(kitchen_0);
	background_layer.add(chefbot_body);
	background_layer.add(chefbot_arm);
	background_layer.add(kitchen_1);
	background_layer.add(conveyor_belt);
	background_layer.add(floor);
	background_layer.add(gradient);

	//Creation and positioning of the wheel
	wheel = game.add.sprite(0, 0, "wheel_sprite");
	wheel.inputEnabled = true;
	wheel.width = 700;
	wheel.height = 700;
	wheel.anchor.set(0.5, 0.5);
	wheel.x = game.width/2;
	wheel.y = game.height + wheel.height/8;
	wheel.angle -= 135;

	foreground_layer.add(wheel);
	//Does some math so fix a so child scaling issues down the line
	var temp_wheel = game.add.sprite(0, 0, "wheel_sprite");
	wheel_antimodifier = 700/temp_wheel.width;
	temp_wheel.destroy();

	//Creation and positioning of the plates (children of the wheel)
	plate_1 = game.add.sprite(0, 0, 'plate_sprite');
	wheel.addChild(plate_1);
	plate_1.anchor.set(0.5, 0.5);
	plate_1.x = 300;
	plate_1.y = 300;
	plate_1.width = plate_1.width / wheel_antimodifier;
	plate_1.height = plate_1.height / wheel_antimodifier;
	plate_1.angle += 135;
	plate_2 = game.add.sprite(0, 0, 'plate_sprite');
	wheel.addChild(plate_2);
	plate_2.anchor.set(0.5, 0.5);
	plate_2.x = -300;
	plate_2.y = -300;
	plate_2.width = plate_2.width / wheel_antimodifier;
	plate_2.height = plate_2.height / wheel_antimodifier;
	plate_2.angle -= 45;
	plate_3 = game.add.sprite(0, 0, 'plate_sprite');
	wheel.addChild(plate_3);
	plate_3.anchor.set(0.5, 0.5);
	plate_3.x = 300;
	plate_3.y = -300;
	plate_3.width = plate_3.width / wheel_antimodifier;
	plate_3.height = plate_3.height / wheel_antimodifier;
	plate_3.angle += 45;

	//Defining of the wheel-spin tweens
	leftTweenAlpha = game.add.tween(wheel).to({angle: "-110"}, tween_duration,
		Phaser.Easing.Quadratic.InOut);
	leftTweenBeta = game.add.tween(wheel).to({angle: "-20"}, tween_duration,
		Phaser.Easing.Quadratic.InOut);
	rightTweenAlpha = game.add.tween(wheel).to({angle: "+110"}, tween_duration,
		Phaser.Easing.Quadratic.InOut);
	rightTweenBeta = game.add.tween(wheel).to({angle: "+20"}, tween_duration,
		Phaser.Easing.Quadratic.InOut);
	leftTweenAlpha.chain(rightTweenBeta);
	rightTweenAlpha.chain(leftTweenBeta);

	//Defining of the plate tweens
	plate1_tweenAlpha = game.add.tween(plate_1).to({x: "+100", y: "+100"}, tween_duration/2,
		Phaser.Easing.Quadratic.In);
	plate1_tweenBeta = game.add.tween(plate_1).to({x: "-100", y: "-100"}, tween_duration/2,
		Phaser.Easing.Quadratic.Out);
	plate1_tweenAlpha.chain(plate1_tweenBeta);

	plate2_tweenAlpha = game.add.tween(plate_2).to({x: "-100", y: "-100"}, tween_duration/2,
		Phaser.Easing.Quadratic.In);
	plate2_tweenBeta = game.add.tween(plate_2).to({x: "+100", y: "+100"}, tween_duration/2,
		Phaser.Easing.Quadratic.Out);
	plate2_tweenAlpha.chain(plate2_tweenBeta);

	plate3_tweenAlpha = game.add.tween(plate_3).to({x: "+100", y: "-100"}, tween_duration/2,
		Phaser.Easing.Quadratic.In);
	plate3_tweenBeta = game.add.tween(plate_3).to({x: "-100", y: "+100"}, tween_duration/2,
		Phaser.Easing.Quadratic.Out);
	plate3_tweenAlpha.chain(plate3_tweenBeta);

	//set lastfall to the current time
	fallingItems = game.add.group();
	superforeground_layer.add(fallingItems);
	nextSpawn = game.time.time + (2000);

	//Defining function call when mouse is clicked/released
	game.input.onDown.add(onClick, this);
	game.input.onUp.add(onRelease, this);

	//Spawns the initial sandwiches
	spawn_sandwich(0);
	spawn_sandwich(1);
	spawn_sandwich(2);

	generateSandwich();
	generateSandwich();
	generateSandwich();
	generateSandwich();

	timer_score_backing = game.add.sprite(0, 0, "timer_backing");
	timer_score_backing.anchor.set(0, 0);

	time_remaining = game.add.text(game.width - 30, 25, "null", {font: "65px Arial", fill: "#3279a8", align: "right"});
	low_time_remaining = game.add.text(game.width - 29, 24, "null", {font: "65px Arial", fill: "#ffffff", align: "right"});
	time_flash = game.add.text(game.width - 30, 25, "null", {font: "65px Arial", fill: "#ffffff", align: "right"});
	low_time_flash = game.add.text(game.width - 29, 24, "null", {font: "65px Arial", fill: "#ff0000", align: "right"});
	time_remaining.anchor.set(1, 0);
	low_time_remaining.anchor.set(1, 0);
	time_flash.anchor.set(1, 0);
	low_time_flash.anchor.set(1, 0);
	low_time_remaining.alpha = 0;
	low_time_remaining.stroke = "#282828";
	low_time_remaining.strokeThickness = 2;
	low_time_flash.alpha = 0;
	low_time_flash.stroke = "#ff0000";
	low_time_flash.strokeThickness = 2;
	end_time = game.time.time + (1000 * 60 * 3);

	score_text = game.add.text(game.width - 30, 115, "null", {font: "38px Arial", fill: "#e2cb53", align: "right"});
	score_text.anchor.set(1, 0);
	score_amount = 0;

	userinterface_layer.add(timer_score_backing);
	userinterface_layer.add(time_remaining);
	userinterface_layer.add(low_time_remaining);
	userinterface_layer.add(time_flash);
	userinterface_layer.add(score_text);
	userinterface_layer.add(low_time_flash);
}

function update() {
	var zero_mod = "";
	if (Math.floor((end_time - game.time.time)/(1000))%60 < 10)
		zero_mod = "0";
	if (game.time.time > end_time)
		time_remaining.text = "0:00";
	else {
		time_remaining.text = Math.floor((end_time - game.time.time)/(1000*60)) + ":" + zero_mod + Math.floor((end_time - game.time.time)/(1000))%60;
		time_flash.text = time_remaining.text;
		low_time_flash.text = time_remaining.text;
		low_time_remaining.text = time_remaining.text;
		time_flash.alpha = (Math.floor(end_time - game.time.time) % 1000)/1000;
		
		if (end_time - game.time.time < 1000*60) {
			low_time_remaining.alpha = 1;
			time_flash.alpha = 0;
			low_time_flash.alpha = (Math.floor(end_time - game.time.time) % 1000)/800 + 0.2;
		}
		else {
			low_time_remaining.alpha = 0;
			low_time_flash.alpha = 0;
		}
	}
	var score_mod = "";
	if (score_amount - Math.floor(score_amount) !== 0)
		score_mod = "0";
	score_text.text = "Đ " + Math.floor(score_amount) + "." + score_mod + Math.floor((score_amount - Math.floor(score_amount))*10);

	if (game.time.time > nextSpawn) {
		var index_to_spawn = game.rnd.integerInRange(0, weighted_item_spawns.length - 1);
		var newItem = game.add.sprite(100, 205, possibleItems[weighted_item_spawns[index_to_spawn]]);
		newItem.lifespan = 5000 + 300 + 600 + 100;
		newItem.width = newItem.width * 0.4;
		newItem.height = newItem.height * 0.6;
		newItem.alpha = 0;
		background_layer.add(newItem);
		newItem.anchor.set(0.5, 0.5);
		var fade_in_tween = game.add.tween(newItem).to({alpha: 1}, 800, Phaser.Easing.Quadratic.InOut);
		fade_in_tween.start();
		var conveyor_tween = game.add.tween(newItem).to({x: 2*game.width/3}, 5000, Phaser.Easing.Linear.InOut);
		var lift_tween = game.add.tween(newItem).to({x: "-20", y: "-10"}, 300, Phaser.Easing.Quadratic.In);
		var launch_tween = game.add.tween(newItem).to({y: -100}, 600, Phaser.Easing.Quartic.In);
		var center_tween = game.add.tween(newItem).to({x: game.width/2, y: -50, width: newItem.width/0.4, height: newItem.height/0.6}, 100, Phaser.Easing.Linear.InOut);
		conveyor_tween.chain(lift_tween);
		lift_tween.chain(launch_tween);
		launch_tween.chain(center_tween);
		conveyor_tween.start();

		nextFall.push(game.time.time + 5000 + 300 + 600 + 100);
		fallQueue.push(possibleItems[weighted_item_spawns[index_to_spawn]]);
		falling_item_numbers.push(weighted_item_spawns[index_to_spawn]);
		nextSpawn = game.time.time + 2000;

		var arm_tween_null = game.add.tween(chefbot_arm).to({alpha: 1}, 5000, Phaser.Easing.Linear.InOut);
		var arm_tween1 = game.add.tween(chefbot_arm).to({x: 2*game.width/3 - 40, y: 310}, 300, Phaser.Easing.Quadratic.In);
		var arm_tween2 = game.add.tween(chefbot_arm).to({x: 2*game.width/3 - 40, y: 220}, 500, Phaser.Easing.Quartic.In);
		var arm_tween3 = game.add.tween(chefbot_arm).to({x: 2*game.width/3 - 20, y: 240}, 550, Phaser.Easing.Quadratic.In);
		var arm_tween4 = game.add.tween(chefbot_arm).to({x: 2*game.width/3 - 20, y: 320}, 750, Phaser.Easing.Quadratic.Out);
		arm_tween3.chain(arm_tween4);
		arm_tween2.chain(arm_tween3);
		arm_tween1.chain(arm_tween2);
		arm_tween_null.chain(arm_tween1);
		arm_tween_null.start();
	}
	if (game.time.time > nextFall[0]) {
		var falling_ingredient = game.add.sprite(game.width/2+game.rnd.integerInRange(-15, 15), -100, fallQueue[0]);
		game.physics.enable(falling_ingredient);
		fallingItems.add(falling_ingredient);
		falling_item_array.push(falling_ingredient);
		falling_ingredient.anchor.set(0.5, 0.5);
		fallQueue.splice(0, 1);
		nextFall.splice(0, 1);
		falling_ingredient.body.acceleration.y = 800;
		falling_ingredient.body.angularVelocity = game.rnd.integerInRange(-30, 30);
	}
	var trash_active = 0;
	//Green Quadrant is up (plate1)
	if (wheel.angle % 360 === 225 || wheel.angle % 360 === -135) {
		active_plate_height = wheel.y - wheel.height/2 - active_sandwich_heights[0];
		active_sandwich_index = 0;
	}
	//Purple Quadrant is up (plate2)
	else if (wheel.angle % 360 === 45 || wheel.angle % 360 === -315) {
		active_plate_height = wheel.y - wheel.height/2 - active_sandwich_heights[1];
		active_sandwich_index = 1;
	}
	//Blue Quadrant is up (plate3)
	else if (wheel.angle % 360 === 315 || wheel.angle % 360 === -45) {
		active_plate_height = wheel.y - wheel.height/2 - active_sandwich_heights[2];
		active_sandwich_index = 2;
	}
	else
		trash_active = 1;

	var y_mod = 0;
	if (falling_item_array.length > 0) {
		var angle_rad = Math.abs(falling_item_array[0].angle) * (3.14/180);
		y_mod = Math.sin(angle_rad) * falling_item_array[0].width/2 * 0.5;
	}
	if (falling_item_array.length > 0 && falling_item_array[0].y > wheel.y - wheel.height/2 && trash_active === 1) {
		var falling_ingredient = falling_item_array[0];
		var fade_tween = game.add.tween(falling_ingredient).to({alpha: 0}, 200, Phaser.Easing.Quadratic.Out);
		fade_tween.start();
		falling_ingredient.lifespan = 200;
		falling_item_array.splice(0, 1);
		falling_item_numbers.splice(0, 1);
	}
	else if (falling_item_array.length > 0 && falling_item_array[0].y > (active_plate_height - y_mod) && trash_active === 0) {
		var falling_ingredient = falling_item_array[0];
		active_sandwich_images[active_sandwich_index].addChild(falling_ingredient);
		falling_ingredient.x = falling_ingredient.x - game.width/2;
		falling_ingredient.y = -1 * (active_sandwich_heights[active_sandwich_index] + y_mod);
		falling_ingredient.body.angularVelocity = 0;
		falling_ingredient.body.velocity.y = 0;
		falling_ingredient.body.acceleration.y = 0;
		falling_ingredient.body.moves = false;
		var flatten_tween = game.add.tween(falling_ingredient).to({angle: 0}, game.rnd.integerInRange(800, 1200), Phaser.Easing.Quadratic.Out);
		var bounce_tween = game.add.tween(falling_ingredient).to({y: (-1*active_sandwich_heights[active_sandwich_index])}, game.rnd.integerInRange(600, 1000), Phaser.Easing.Bounce.Out);
		flatten_tween.start();
		bounce_tween.start();
		falling_item_array.splice(0, 1);
		active_sandwich_heights[active_sandwich_index] += game.rnd.integerInRange(16, 20);
		active_sandwiches[active_sandwich_index].push(falling_item_numbers[0]);

		var added_letter = game.add.sprite(0, 40, possibleLetters[falling_item_numbers[0]]);
		added_letter.alpha = 0;
		active_sandwich_images[active_sandwich_index].addChild(added_letter);
		added_letter.anchor.set(0.5, 0);
		added_letter.x = active_letter_locations_x[active_sandwiches[active_sandwich_index].length - 1];
		added_letter.y = active_letter_locations_y[active_sandwiches[active_sandwich_index].length - 1] - 10;
		added_letter.width *= 1.5;
		added_letter.height *= 1.5;
		var letter_tween = game.add.tween(added_letter).to({alpha: 1, y: "+20"}, 200, Phaser.Easing.Quadratic.InOut);
		letter_tween.start();


		falling_item_numbers.splice(0, 1);

		if (active_sandwiches[active_sandwich_index].length > 11)
			nix_sandwich(active_sandwich_index);
	}
}

//Function called on left-click start
function onClick() {
	x_on_start = game.input.mousePointer.x;
	y_on_start = game.input.mousePointer.y;
	//spawn_currency(x_on_start, y_on_start, 4);
}
//Function called on left-click release
function onRelease() {
	x_on_stop = game.input.mousePointer.x;
	y_on_stop = game.input.mousePointer.y;
	var distX = x_on_stop - x_on_start;
	var distY = y_on_stop - y_on_start;
	//Swipe was horizontal (distX more that twice as large as distY)
	if (Math.abs(distX) > Math.abs(distY)*2 && Math.abs(distX) > 10) {
		//Left Swipe
		if (distX < 0) {
			if (wheel.angle % 90 === 45 || wheel.angle % 90 === -45)
				leftTweenAlpha.start();
		}
		//Right Swipe
		else {
			if (wheel.angle % 90 === 45 || wheel.angle % 90 === -45)
				rightTweenAlpha.start();
		}
	}
	else if (Math.abs(distY) > Math.abs(distX)*2 && Math.abs(distY) > 10) {
		//Up Swipe
		if (distY < 0) {
			//Purple Quadrant is up (plate2)
			if (wheel.angle % 360 === 45 || wheel.angle % 360 === -315) {
				//plate2_tweenAlpha.start();
				nix_sandwich(1);
			}
			//Trash Quadrant is up
			else if (wheel.angle % 360 === 135 || wheel.angle % 360 === -225) {
				
			}
			//Green Quadrant is up (plate1)
			else if (wheel.angle % 360 === 225 || wheel.angle % 360 === -135) {
				//plate1_tweenAlpha.start();
				nix_sandwich(0);
			}
			//Blue Quadrant is up (plate3)
			else if (wheel.angle % 360 === 315 || wheel.angle % 360 === -45) {
				//plate3_tweenAlpha.start();
				nix_sandwich(2);
			}
		}
		//Down Swipe
		if (distY > 0) {
			check_plates_for_recipe();
		}
	}
}

//Function called to generate sandwich recipe
function generateSandwich() {
	if (active_recipes.length === 4)
		return;
	var sandwich = game.add.sprite(0, 0, "bread_sprite");
	var recipe_image = game.add.sprite(0, 0, "recipe_backing");
	background_layer.add(recipe_image);
	recipe_image.anchor.set(0.5, 0.5);
	recipe_image.alpha = 0;
	recipe_image.addChild(sandwich);
	recipe_image.x = 135 + (active_recipes.length % 4 * (recipe_image.width + 5));
	recipe_image.y = 345 - recipe_image.height - 5;
	sandwich.anchor.set(0.5, 0.5);
	sandwich.width = 0.8 * sandwich.width;
	var sandwich_height = 0;
	var sandwich_size = game.rnd.integerInRange(2, sandwich_max_size);
	var letter_mod = 2;
	var letter_header = game.add.sprite(0, 0, "blank_sprite");
	recipe_image.addChild(letter_header);
	letter_header.x = -(sandwich_size/2 * 21);
	var ingredient_array = [];
	for (var i = 0; i < sandwich_size; ++i) {
		var ingredient_number = game.rnd.integerInRange(0, possibleItems.length - 1);
		weighted_item_spawns.push(ingredient_number);
		var next_ingredient;
		if (ingredient_number === 0) {
			next_ingredient = game.add.sprite(0, 0, "cheese_sprite");
			var letter = game.add.sprite(0, 0, "cheese_letter");
			ingredient_array.push(0);
		}
		else if (ingredient_number === 1) {
			next_ingredient = game.add.sprite(0, 0, "onion_sprite");
			var letter = game.add.sprite(0, 0, "onion_letter");
			ingredient_array.push(1);
		}
		else if (ingredient_number === 2) {
			next_ingredient = game.add.sprite(0, 0, "tomato_sprite");
			var letter = game.add.sprite(0, 0, "tomato_letter");
			ingredient_array.push(2);
		}
		else if (ingredient_number === 3) {
			next_ingredient = game.add.sprite(0, 0, "lettuce_sprite");
			var letter = game.add.sprite(0, 0, "lettuce_letter");
			ingredient_array.push(3);
		}
		else if (ingredient_number === 4) {
			next_ingredient = game.add.sprite(0, 0, "ham_sprite");
			var letter = game.add.sprite(0, 0, "ham_letter");
			ingredient_array.push(4);
		}
		else if (ingredient_number === 5) {
			next_ingredient = game.add.sprite(0, 0, "turkey_sprite");
			var letter = game.add.sprite(0, 0, "turkey_letter");
			ingredient_array.push(5);
		}
		else if (ingredient_number === 6) {
			next_ingredient = game.add.sprite(0, 0, "peanutbutter_sprite");
			var letter = game.add.sprite(0, 0, "peanutbutter_letter");
			ingredient_array.push(6);
		}
		else if (ingredient_number === 7) {
			next_ingredient = game.add.sprite(0, 0, "jelly_sprite");
			var letter = game.add.sprite(0, 0, "jelly_letter");
			ingredient_array.push(7);
		}
		else if (ingredient_number === 8) {
			next_ingredient = game.add.sprite(0, 0, "bacon_sprite");
			var letter = game.add.sprite(0, 0, "bacon_letter");
			ingredient_array.push(8);
		}
		else if (ingredient_number === 9) {
			next_ingredient = game.add.sprite(0, 0, "pickle_sprite");
			var letter = game.add.sprite(0, 0, "pickle_letter");
			ingredient_array.push(9);
		}
		else if (ingredient_number === 10) {
			next_ingredient = game.add.sprite(0, 0, "mayo_sprite");
			var letter = game.add.sprite(0, 0, "mayo_letter");
			ingredient_array.push(10);
		}
		next_ingredient.anchor.set(0.5, 0.5);
		sandwich.addChild(next_ingredient);
		next_ingredient.x = game.rnd.integerInRange(-15, 15);
		sandwich_height += 20 * sandwich_scale;
		next_ingredient.y = -1 * sandwich_height;
		letter.anchor.set(0.5, 0.5);
		letter_header.addChild(letter);
		letter.x = (36 * (sandwich_scale + 0.1) * i);
		letter.y = ((46 + letter_mod) * (sandwich_scale)) + 22;
		letter.angle = letter.angle + game.rnd.integerInRange(-10, 10);
		letter_mod = letter_mod * -1;
	}
	var sandwich_top = game.add.sprite(0, 0, "bread_sprite");
	sandwich_top.anchor.set(0.5, 0.5);
	sandwich.addChild(sandwich_top);
	sandwich_height += game.rnd.integerInRange(18, 20);
	sandwich_top.y = -1 * sandwich_height;
	sandwich.width = sandwich.width * sandwich_scale;
	sandwich.height = sandwich.height * sandwich_scale;
	active_recipes.push(ingredient_array);
	active_recipe_images.push(recipe_image);
	var recipe_slide_in = game.add.tween(recipe_image).to({y: recipe_image.y + (recipe_image.height + 5)}, tween_duration, Phaser.Easing.Quadratic.InOut);
	var recipe_fade_in = game.add.tween(recipe_image).to({alpha: 1}, tween_duration, Phaser.Easing.Quadratic.InOut);
	recipe_slide_in.start();
	recipe_fade_in.start();
}

//Function called to compare active recipes against plate contents (aka active sancwiches)
function check_plates_for_recipe() {
	//Green Quadrant is up (plate1)
	if (wheel.angle % 360 === 225 || wheel.angle % 360 === -135) {
		//loops over all active recipes
		for (var i = 0; i < active_recipes.length; ++i) {
			//checks if size of active recipe and size of active sandwich are different
			if (active_recipes[i].length !== active_sandwiches[0].length)
				continue;
			var sandwich_copy = active_sandwiches[0].slice();
			//loops over all ingredients of active recipe
			for (var j = 0; j < active_recipes[i].length; ++j) {
				//searches for matching ingredient in active sandwich
				for (var k = 0; k < sandwich_copy.length; ++k) {
					if (active_recipes[i][j] === sandwich_copy[k]) {
						sandwich_copy.splice(k, 1);
						break;
					}
				}
			}
			//checks if all ingredients were removed (matched to recipe)
			if (sandwich_copy.length !== 0)
				continue;
			//recipe matched the plate contents
			end_time = end_time + 1000 * 8 * active_recipes[i].length;
			score_amount = score_amount + 1.7 * (active_recipes[i].length + 2) + game.rnd.integerInRange(0, 9)/10;
			spawn_currency(game.width/2, wheel.y - wheel.height/2, active_recipes[i].length);
			nix_recipe(i);
			complete_sandwich(0);
			generateSandwich();
			return;
		}
	}
	//Purple Quadrant is up (plate2)
	else if (wheel.angle % 360 === 45 || wheel.angle % 360 === -315) {
		//loops over all active recipes
		for (var i = 0; i < active_recipes.length; ++i) {
			//checks if size of active recipe and size of active sandwich are different
			if (active_recipes[i].length !== active_sandwiches[1].length)
				continue;
			var sandwich_copy = active_sandwiches[1].slice();
			//loops over all ingredients of active recipe
			for (var j = 0; j < active_recipes[i].length; ++j) {
				//searches for matching ingredient in active sandwich
				for (var k = 0; k < sandwich_copy.length; ++k) {
					if (active_recipes[i][j] === sandwich_copy[k]) {
						sandwich_copy.splice(k, 1);
						break;
					}
				}
			}
			//checks if all ingredients were removed (matched to recipe)
			if (sandwich_copy.length !== 0)
				continue;
			//recipe matched the plate contents
			end_time = end_time + 1000 * 8 * active_recipes[i].length;
			score_amount = score_amount + 1.7 * (active_recipes[i].length + 2) + game.rnd.integerInRange(0, 9)/10;
			spawn_currency(game.width/2, wheel.y - wheel.height/2, active_recipes[i].length);
			nix_recipe(i);
			complete_sandwich(1);
			generateSandwich();
			return;
		}
	}
	//Blue Quadrant is up (plate3)
	else if (wheel.angle % 360 === 315 || wheel.angle % 360 === -45) {
		//loops over all active recipes
		for (var i = 0; i < active_recipes.length; ++i) {
			//checks if size of active recipe and size of active sandwich are different
			if (active_recipes[i].length !== active_sandwiches[2].length)
				continue;
			var sandwich_copy = active_sandwiches[2].slice();
			//loops over all ingredients of active recipe
			for (var j = 0; j < active_recipes[i].length; ++j) {
				//searches for matching ingredient in active sandwich
				for (var k = 0; k < sandwich_copy.length; ++k) {
					if (active_recipes[i][j] === sandwich_copy[k]) {
						sandwich_copy.splice(k, 1);
						break;
					}
				}
			}
			//checks if all ingredients were removed (matched to recipe)
			if (sandwich_copy.length !== 0)
				continue;
			//recipe matched the plate contents
			end_time = end_time + 1000 * 8 * active_recipes[i].length;
			score_amount = score_amount + 1.7 * (active_recipes[i].length + 2) + game.rnd.integerInRange(0, 9)/10;
			spawn_currency(game.width/2, wheel.y - wheel.height/2, active_recipes[i].length);
			nix_recipe(i);
			complete_sandwich(2);
			generateSandwich();
			return;
		}
	}
}

//Function for killing a recipe (deletes data, handles animation, etc)
function nix_recipe(recipe_index) {
	var target_sprite = active_recipe_images[recipe_index];
	for (var i = recipe_index + 1; i < active_recipe_images.length; ++i) {
		var recipe_slide = game.add.tween(active_recipe_images[i]).to({x: active_recipe_images[i].x - (active_recipe_images[i].width + 5)}, tween_duration, Phaser.Easing.Quadratic.InOut);
		recipe_slide.start();
	}
	for (var i = 0; i < active_recipes[recipe_index].length; ++i) {
		for (var j = 0; j < weighted_item_spawns.length; ++j) {
			if (active_recipes[recipe_index][i] === weighted_item_spawns[j]) {
				weighted_item_spawns.splice(j, 1);
				break;
			}
		}
	}
	active_recipes.splice(recipe_index, 1);
	active_recipe_images.splice(recipe_index, 1);

	var recipe_slide_out = game.add.tween(target_sprite).to({y: target_sprite.y - (target_sprite.height + 5)}, tween_duration, Phaser.Easing.Quadratic.InOut);
	var recipe_fade_out = game.add.tween(target_sprite).to({alpha: 0}, tween_duration, Phaser.Easing.Quadratic.InOut);
	target_sprite.lifespan = tween_duration;
	recipe_slide_out.start();
	recipe_fade_out.start();

	sandwiches_completed += 1;
	if (sandwich_max_size < 6)
		sandwich_max_size = Math.floor(3 + (sandwiches_completed / 3));
}

//Function for killing a sandwich (deletes data, handles animation, etc)
function nix_sandwich(sandwich_index) {
	if (active_sandwiches[sandwich_index].length < 1)
		return;
	var target_sprite = active_sandwich_images[sandwich_index];
	var fade_tween = game.add.tween(target_sprite).to({alpha: 0}, 500, Phaser.Easing.Quadratic.Out);
	fade_tween.start();
	target_sprite.lifespan = 500;
	for (var i = 0; i < active_sandwiches[sandwich_index].length; ++i) {
		if (active_sandwiches[sandwich_index][i] === 0) {
			var emitter = game.add.emitter(game.width/2, wheel.y - wheel.height/2 - (i*18), 200);
			emitter.makeParticles("cheese_sprite");
			emitter.gravity = 1000;
			emitter.width = 100;
			emitter.height = 100;
			emitter.start(true, 2000, null, 1);
		}
		else if (active_sandwiches[sandwich_index][i] === 1) {
			var emitter = game.add.emitter(game.width/2, wheel.y - wheel.height/2 - (i*18), 200);
			emitter.makeParticles("onion_sprite");
			emitter.gravity = 1000;
			emitter.width = 100;
			emitter.height = 100;
			emitter.start(true, 2000, null, 1);
		}
		else if (active_sandwiches[sandwich_index][i] === 2) {
			var emitter = game.add.emitter(game.width/2, wheel.y - wheel.height/2 - (i*18), 200);
			emitter.makeParticles("tomato_sprite");
			emitter.gravity = 1000;
			emitter.width = 100;
			emitter.height = 100;
			emitter.start(true, 2000, null, 1);
		}
		else if (active_sandwiches[sandwich_index][i] === 3) {
			var emitter = game.add.emitter(game.width/2, wheel.y - wheel.height/2 - (i*18), 200);
			emitter.makeParticles("lettuce_sprite");
			emitter.gravity = 1000;
			emitter.width = 100;
			emitter.height = 100;
			emitter.start(true, 2000, null, 1);
		}
		else if (active_sandwiches[sandwich_index][i] === 4) {
			var emitter = game.add.emitter(game.width/2, wheel.y - wheel.height/2 - (i*18), 200);
			emitter.makeParticles("ham_sprite");
			emitter.gravity = 1000;
			emitter.width = 100;
			emitter.height = 100;
			emitter.start(true, 2000, null, 1);
		}
		else if (active_sandwiches[sandwich_index][i] === 5) {
			var emitter = game.add.emitter(game.width/2, wheel.y - wheel.height/2 - (i*18), 200);
			emitter.makeParticles("turkey_sprite");
			emitter.gravity = 1000;
			emitter.width = 100;
			emitter.height = 100;
			emitter.start(true, 2000, null, 1);
		}
		else if (active_sandwiches[sandwich_index][i] === 6) {
			var emitter = game.add.emitter(game.width/2, wheel.y - wheel.height/2 - (i*18), 200);
			emitter.makeParticles("peanutbutter_sprite");
			emitter.gravity = 1000;
			emitter.width = 100;
			emitter.height = 100;
			emitter.start(true, 2000, null, 1);
		}
		else if (active_sandwiches[sandwich_index][i] === 7) {
			var emitter = game.add.emitter(game.width/2, wheel.y - wheel.height/2 - (i*18), 200);
			emitter.makeParticles("jelly_sprite");
			emitter.gravity = 1000;
			emitter.width = 100;
			emitter.height = 100;
			emitter.start(true, 2000, null, 1);
		}
		else if (active_sandwiches[sandwich_index][i] === 8) {
			var emitter = game.add.emitter(game.width/2, wheel.y - wheel.height/2 - (i*18), 200);
			emitter.makeParticles("bacon_sprite");
			emitter.gravity = 1000;
			emitter.width = 100;
			emitter.height = 100;
			emitter.start(true, 2000, null, 1);
		}
		else if (active_sandwiches[sandwich_index][i] === 9) {
			var emitter = game.add.emitter(game.width/2, wheel.y - wheel.height/2 - (i*18), 200);
			emitter.makeParticles("pickle_sprite");
			emitter.gravity = 1000;
			emitter.width = 100;
			emitter.height = 100;
			emitter.start(true, 2000, null, 1);
		}
		else if (active_sandwiches[sandwich_index][i] === 10) {
			var emitter = game.add.emitter(game.width/2, wheel.y - wheel.height/2 - (i*18), 200);
			emitter.makeParticles("mayo_sprite");
			emitter.gravity = 1000;
			emitter.width = 100;
			emitter.height = 100;
			emitter.start(true, 2000, null, 1);
		}
	}
	var emitter = game.add.emitter(game.width/2, wheel.y - wheel.height/2 - (i*18), 100);
	emitter.makeParticles("bread_sprite");
	emitter.gravity = 1000;
	emitter.width = 100;
	emitter.height = 100;
	emitter.start(true, 2000, null, 1);
	active_sandwiches[sandwich_index] = [];
	//target_sprite.destroy();
	spawn_sandwich(sandwich_index);
}

//Function to complete and remove a sandwich from a specified plate
function complete_sandwich(sandwich_index) {
	if (active_sandwiches[sandwich_index].length < 1)
		return;
	var target_sprite = active_sandwich_images[sandwich_index];
	var final_bread = game.add.sprite(0, (-1 * active_sandwich_heights[sandwich_index] - 100), "bread_sprite");
	final_bread.anchor.set(0.5, 0.5);
	target_sprite.addChild(final_bread);
	var target_y = (-1 * active_sandwich_heights[sandwich_index]);
	var bread_tween = game.add.tween(final_bread).to({alpha: 1, y: target_y}, 400, Phaser.Easing.Bounce.Out);
	bread_tween.start();

	var null_tween = game.add.tween(target_sprite).to({alpha: 1}, 400, Phaser.Easing.Linear.InOut);
	var fade_tween = game.add.tween(target_sprite).to({alpha: 0, y: "-400"}, 600, Phaser.Easing.Quadratic.Out);
	null_tween.chain(fade_tween);
	null_tween.start();
	target_sprite.lifespan = 1000;
	spawn_sandwich(sandwich_index);
}

//Function to spawn a new, blank sandwich on a specified plate
function spawn_sandwich(sandwich_index) {
	var new_sandwich = game.add.sprite(0, -200, "bread_sprite");
	new_sandwich.alpha = 0;
	new_sandwich.anchor.set(0.5, 0.7);
	//Spawn sandwich on plate1
	if (sandwich_index === 0) {
		active_sandwich_heights[0] = new_sandwich.height/2.5;
		plate_1.addChild(new_sandwich);
		active_sandwich_images[0] = new_sandwich;
		active_sandwiches[0] = [];
	}
	//Spawn sandwich on plate2
	else if (sandwich_index === 1) {
		active_sandwich_heights[1] = new_sandwich.height/2.5;
		plate_2.addChild(new_sandwich);
		active_sandwich_images[1] = new_sandwich;
		active_sandwiches[2] = [];
	}
	//Spawn sandwich on plate3
	else if (sandwich_index === 2) {
		active_sandwich_heights[2] = new_sandwich.height/2.5;
		plate_3.addChild(new_sandwich);
		active_sandwich_images[2] = new_sandwich;
		active_sandwiches[2] = [];
	}
	var null_tween = game.add.tween(new_sandwich).to({alpha: 0}, 800, Phaser.Easing.Linear.InOut);
	var bread_tween = game.add.tween(new_sandwich).to({alpha: 1, y: 0}, 800, Phaser.Easing.Bounce.Out);
	null_tween.chain(bread_tween);
	null_tween.start();
}

//Function to create a burst of coins
function spawn_currency(x_value, y_value, amount) {
	for (var i = 0; i < amount * game.rnd.integerInRange(1, 4); ++i) {
		var new_coin = game.add.sprite(0, 0, "currency_sprite");
		new_coin.anchor.set(0.5, 0.5);
		new_coin.alpha = 0;
		new_coin.x = x_value + game.rnd.integerInRange(-100, 100);
		new_coin.y = y_value - game.rnd.integerInRange(-20, amount * 20);
		new_coin.width /= 10;
		new_coin.height /= 10;
		var coin_duration = game.rnd.integerInRange(600, 1200);
		new_coin.lifespan = coin_duration;
		move_tween = game.add.tween(new_coin).to({x: score_text.x, y: score_text.y}, coin_duration, Phaser.Easing.Quadratic.In);
		move_tween.start();
		fade_in_tween = game.add.tween(new_coin).to({alpha: 1}, 200, Phaser.Easing.Quadratic.InOut);
		scale_in_tween = game.add.tween(new_coin.scale).to({x: 0.8, y: 0.8}, 200, Phaser.Easing.Quadratic.InOut);
		fade_out_tween = game.add.tween(new_coin).to({alpha: 0}, coin_duration - 200, Phaser.Easing.Quintic.In);
		fade_in_tween.chain(fade_out_tween);
		scale_in_tween.start();
		fade_in_tween.start();
		foreground_layer.add(new_coin);
	}
}

</script>
</body>
</html>